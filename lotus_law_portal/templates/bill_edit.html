<!-- templates/bill_edit.html -->
{% extends "base.html" %}
{% block content %}
<div class="container">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h3 mb-0">Edit Bill</h1>
    <a class="btn btn-outline-primary" href="{{ url_for('bills') }}">Back to Bills</a>
  </div>

  <form method="POST" class="needs-validation" novalidate>
    <div class="row g-4">
      <!-- Left column -->
      <div class="col-lg-6">
        <div class="mb-3">
          <label for="client_id" class="form-label">Client</label>
          <select id="client_id" name="client_id" class="form-select" required>
            <option value="">Select clientâ€¦</option>
            {% for c in clients %}
              <option value="{{ c.id }}" {% if c.id == b.client_id %}selected{% endif %}>{{ c.name }}</option>
            {% endfor %}
          </select>
          <div class="invalid-feedback">Client is required.</div>
        </div>

        <div class="mb-3">
          <label for="bill_no" class="form-label">Bill No</label>
          <input id="bill_no" name="bill_no" class="form-control" value="{{ b.bill_no }}" required>
          <div class="invalid-feedback">Bill number is required.</div>
        </div>

        <div class="row g-3">
          <div class="col-md-6">
            <label for="bill_date" class="form-label">Bill Date</label>
            <input type="date" id="bill_date" name="bill_date" class="form-control"
                   value="{{ b.bill_date }}" required>
            <div class="invalid-feedback">Bill date is required.</div>
          </div>
          <div class="col-md-6">
            <label for="amount" class="form-label">Amount</label>
            <input type="number" step="0.01" id="amount" name="amount" class="form-control"
                   value="{{ b.amount }}" required>
            <div class="invalid-feedback">Enter a valid amount.</div>
          </div>
        </div>
      </div>

      <!-- Right column -->
      <div class="col-lg-6">
        <div class="mb-3">
          <label for="Subject" class="form-label">Subject</label>
          <input id="Subject" name="Subject" class="form-control" value="{{ b.Subject or '' }}">
        </div>

        <div class="mb-3">
          <label for="description" class="form-label">Description</label>
          <textarea id="description" name="description" class="form-control" rows="5">{{ b.description or '' }}</textarea>
        </div>

        <div class="mb-3">
          <label for="remarks" class="form-label">Remarks</label>
          <textarea id="remarks" name="remarks" class="form-control" rows="5">{{ b.remarks or '' }}</textarea>
        </div>
      </div>
    </div>

    <div class="d-flex gap-2 mt-4">
      <button type="submit" class="btn btn-primary">Update</button>
      <a class="btn btn-outline-primary" href="{{ url_for('bills') }}">Cancel</a>
    </div>
  </form>
</div>

<script>
  // Bootstrap validation pattern
  (function () {
    'use strict';
    const forms = document.querySelectorAll('.needs-validation');
    Array.prototype.slice.call(forms).forEach(function (form) {
      form.addEventListener('submit', function (event) {
        if (!form.checkValidity()) { event.preventDefault(); event.stopPropagation(); }
        form.classList.add('was-validated');
      }, false);
    });
  })();

  // Enhance selects with Tom Select (keeps parity with receipt edit UI)
  document.addEventListener('DOMContentLoaded', function () {
    if (window.TomSelect) {
      new TomSelect('#client_id', { allowEmptyOption: true, maxOptions: 500 });
    }
  });
</script>
{% endblock %}
